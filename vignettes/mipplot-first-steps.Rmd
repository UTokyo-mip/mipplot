---
title: "First steps with the mipplot package"
author: "U-Tokyo mipplot team"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
  #github_document
  #pdf_document
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## 概要

`mipplot` パッケージは IAMC template format のデータを可視化するための `R` パッケージです。

この vignette では `mipplot` パッケージの基本機能を紹介します。

## 利用するデータ

この vignette では SR1.5 データのサブセットを使用します。
このデータは `mipplot` に含まれており、別途ダウンロードするは必要ありません。

## load library
load `mipplot` library.
```{r}
library(mipplot)
```

## load sample data
IAMC フォーマットのデータ ファイルを読み込みます。
もしあなたが IAMC フォーマットのデータ ファイルを持っていれば、それを使用しても構いません。

この文書では、我々が `mipplot` パッケージに付属しているサンプル データを使う場合のコードを記載します。
```{r}
# mipplot パッケージ内のファイルを使うための特別なコードです。
# あなたがデータ ファイルをお持ちであれば、このコードは必要ありません。
# このコードは、mipplot パッケージ内のデータ ファイルのパスを取得します。
data_file_path <- system.file("mipplot", "iamc15_sample_data.csv", package = "mipplot") 
```

`iamc_data` という変数に IAMC 形式のデータを読み込みましょう。

```{r}
iamc_data <- mipplot::mipplot_read_iamc(data_file_path)
```

読み込んだ IAMC データ ファイルに含まれるモデルの一覧を確認します。

```{r}
iamc_data$model %>% levels
```

シナリオの一覧を確認します。

```{r}
iamc_data$scenario %>% levels
```

地域の一覧を確認します。

```{r}
iamc_data$region %>% levels()
```

変数の一覧を確認します。

```{r}
iamc_data %>% dplyr::select(variable, unit)  %>% dplyr::distinct()
```

## フィルタリング

`SSP2` のシナリオを含むモデルのみ抽出してみます。

```{r}
iamc_data %>% 
  dplyr::filter(stringr::str_detect(scenario, "^SSP2")) %>%
  dplyr::select(model, scenario) %>% dplyr::distinct()
```

**Final Energy|Industry|** 以下の変数の一覧を抽出しましょう。

```{r}
iamc_data %>% 
  dplyr::filter(stringr::str_detect(variable, "Final Energy\\|Industry\\|")) %>% 
  dplyr::select(variable) %>%
  dplyr::distinct()
```

## Visualization of Timeseries

モデルと期間を指定してデータをフィルタし、`mipplot_line` 関数でプロットします。
```{r fig1, fig.height = 4, fig.width = 7}
iamc_data %>%
  dplyr::filter( model %in% c("AIM/CGE 2.0", "GCAM 4.2") ) %>%
  dplyr::filter(2000 <= period) %>%
  dplyr::filter(period <= 2100) %>%
  mipplot_line(
    variable = c("Emissions|CO2"),
    scenario = c("SSP1-19", "SSP1-26", "SSP1-34", "SSP1-45"),
    region = c("World"),
    legend = TRUE)
```

